{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PrebuildResult",
  "type": "object",
  "required": [
    "dependencyInfo",
    "fileBuilds"
  ],
  "properties": {
    "dependencyInfo": {
      "$ref": "#/definitions/DependencyInfo"
    },
    "fileBuilds": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/FilePrebuildResult"
      }
    }
  },
  "definitions": {
    "AddressSpace": {
      "oneOf": [
        {
          "type": "string",
          "enum": [
            "Function",
            "Private",
            "WorkGroup",
            "Uniform",
            "Handle",
            "PushConstant"
          ]
        },
        {
          "type": "object",
          "required": [
            "Storage"
          ],
          "properties": {
            "Storage": {
              "type": "object",
              "required": [
                "access"
              ],
              "properties": {
                "access": {
                  "type": "integer",
                  "format": "uint32",
                  "minimum": 0.0
                }
              }
            }
          },
          "additionalProperties": false
        }
      ]
    },
    "ArraySize": {
      "oneOf": [
        {
          "type": "string",
          "enum": [
            "Dynamic"
          ]
        },
        {
          "type": "object",
          "required": [
            "Constant"
          ],
          "properties": {
            "Constant": {
              "type": "integer",
              "format": "uint32",
              "minimum": 0.0
            }
          },
          "additionalProperties": false
        }
      ]
    },
    "Binding": {
      "oneOf": [
        {
          "type": "object",
          "required": [
            "Builtin"
          ],
          "properties": {
            "Builtin": {
              "$ref": "#/definitions/Builtin"
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "required": [
            "Location"
          ],
          "properties": {
            "Location": {
              "type": "object",
              "required": [
                "location"
              ],
              "properties": {
                "interpolation": {
                  "anyOf": [
                    {
                      "$ref": "#/definitions/Interpolation"
                    },
                    {
                      "type": "null"
                    }
                  ]
                },
                "location": {
                  "type": "integer",
                  "format": "uint32",
                  "minimum": 0.0
                },
                "sampling": {
                  "anyOf": [
                    {
                      "$ref": "#/definitions/Sampling"
                    },
                    {
                      "type": "null"
                    }
                  ]
                }
              }
            }
          },
          "additionalProperties": false
        }
      ]
    },
    "Builtin": {
      "oneOf": [
        {
          "type": "string",
          "enum": [
            "ViewIndex",
            "BaseInstance",
            "BaseVertex",
            "ClipDistance",
            "CullDistance",
            "InstanceIndex",
            "PointSize",
            "VertexIndex",
            "FragDepth",
            "FrontFacing",
            "PrimitiveIndex",
            "SampleIndex",
            "SampleMask",
            "GlobalInvocationId",
            "LocalInvocationId",
            "LocalInvocationIndex",
            "WorkGroupId",
            "WorkGroupSize",
            "NumWorkGroups"
          ]
        },
        {
          "type": "object",
          "required": [
            "Position"
          ],
          "properties": {
            "Position": {
              "type": "object",
              "required": [
                "invariant"
              ],
              "properties": {
                "invariant": {
                  "type": "boolean"
                }
              }
            }
          },
          "additionalProperties": false
        }
      ]
    },
    "CompileError": {
      "type": "object",
      "required": [
        "message"
      ],
      "properties": {
        "message": {
          "type": "string"
        },
        "span": {
          "anyOf": [
            {
              "$ref": "#/definitions/SourceLocation"
            },
            {
              "type": "null"
            }
          ]
        }
      }
    },
    "DependencyInfo": {
      "type": "object",
      "required": [
        "deps"
      ],
      "properties": {
        "deps": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/FileDependencyInfo"
          }
        }
      }
    },
    "EntryPoint": {
      "type": "object",
      "required": [
        "function",
        "name",
        "stage",
        "workgroup_size"
      ],
      "properties": {
        "function": {
          "$ref": "#/definitions/Function"
        },
        "name": {
          "type": "string"
        },
        "stage": {
          "$ref": "#/definitions/ShaderStage"
        },
        "workgroup_size": {
          "type": "array",
          "items": {
            "type": "integer",
            "format": "uint32",
            "minimum": 0.0
          },
          "maxItems": 3,
          "minItems": 3
        }
      }
    },
    "File": {
      "description": "Encapsulates all data needed to emulate a file in gputoy virtual directory structure.",
      "type": "object",
      "required": [
        "data",
        "dir",
        "extension",
        "fileName"
      ],
      "properties": {
        "data": {
          "description": "Contents of file in plain text",
          "type": "string"
        },
        "dir": {
          "description": "File path starting at / (project root)",
          "type": "string"
        },
        "extension": {
          "description": "File extension",
          "allOf": [
            {
              "$ref": "#/definitions/SupportedExtension"
            }
          ]
        },
        "fetch": {
          "description": "Fetch url. If exists, then contents will be fetched from remote URL on project load",
          "type": [
            "string",
            "null"
          ]
        },
        "fileName": {
          "description": "Name of file",
          "type": "string"
        }
      }
    },
    "FileDependencyInfo": {
      "type": "object",
      "required": [
        "exxports",
        "imports"
      ],
      "properties": {
        "errors": {
          "type": [
            "array",
            "null"
          ],
          "items": {
            "$ref": "#/definitions/CompileError"
          }
        },
        "exxports": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/Match"
          }
        },
        "imports": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Match"
          }
        }
      }
    },
    "FilePrebuildResult": {
      "type": "object",
      "required": [
        "processedShader"
      ],
      "properties": {
        "errors": {
          "type": [
            "array",
            "null"
          ],
          "items": {
            "$ref": "#/definitions/CompileError"
          }
        },
        "processedShader": {
          "$ref": "#/definitions/File"
        },
        "rawModule": {
          "anyOf": [
            {
              "$ref": "#/definitions/Module"
            },
            {
              "type": "null"
            }
          ]
        }
      }
    },
    "Function": {
      "type": "object",
      "required": [
        "arguments"
      ],
      "properties": {
        "arguments": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/FunctionArgument"
          }
        },
        "name": {
          "type": [
            "string",
            "null"
          ]
        },
        "result": {
          "anyOf": [
            {
              "$ref": "#/definitions/FunctionResult"
            },
            {
              "type": "null"
            }
          ]
        }
      }
    },
    "FunctionArgument": {
      "type": "object",
      "required": [
        "ty"
      ],
      "properties": {
        "binding": {
          "anyOf": [
            {
              "$ref": "#/definitions/Binding"
            },
            {
              "type": "null"
            }
          ]
        },
        "name": {
          "type": [
            "string",
            "null"
          ]
        },
        "ty": {
          "type": "integer",
          "format": "uint",
          "minimum": 0.0
        }
      }
    },
    "FunctionResult": {
      "type": "object",
      "required": [
        "ty"
      ],
      "properties": {
        "binding": {
          "anyOf": [
            {
              "$ref": "#/definitions/Binding"
            },
            {
              "type": "null"
            }
          ]
        },
        "ty": {
          "type": "integer",
          "format": "uint",
          "minimum": 0.0
        }
      }
    },
    "ImageClass": {
      "oneOf": [
        {
          "type": "object",
          "required": [
            "Sampled"
          ],
          "properties": {
            "Sampled": {
              "type": "object",
              "required": [
                "kind",
                "multi"
              ],
              "properties": {
                "kind": {
                  "$ref": "#/definitions/ScalarKind"
                },
                "multi": {
                  "type": "boolean"
                }
              }
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "required": [
            "Depth"
          ],
          "properties": {
            "Depth": {
              "type": "object",
              "required": [
                "multi"
              ],
              "properties": {
                "multi": {
                  "type": "boolean"
                }
              }
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "required": [
            "Storage"
          ],
          "properties": {
            "Storage": {
              "type": "object",
              "required": [
                "access",
                "format"
              ],
              "properties": {
                "access": {
                  "type": "integer",
                  "format": "uint32",
                  "minimum": 0.0
                },
                "format": {
                  "$ref": "#/definitions/StorageFormat"
                }
              }
            }
          },
          "additionalProperties": false
        }
      ]
    },
    "ImageDimension": {
      "type": "string",
      "enum": [
        "1d",
        "2d",
        "3d",
        "cube"
      ]
    },
    "Interpolation": {
      "type": "string",
      "enum": [
        "Perspective",
        "Linear",
        "Flat"
      ]
    },
    "Match": {
      "description": "Identical to regex::Match, except the text is owned and it can be serialized. TODO: get refs to work within the compiler instead of owned strings.",
      "type": "object",
      "required": [
        "end",
        "start",
        "text"
      ],
      "properties": {
        "end": {
          "type": "integer",
          "format": "uint",
          "minimum": 0.0
        },
        "start": {
          "type": "integer",
          "format": "uint",
          "minimum": 0.0
        },
        "text": {
          "type": "string"
        }
      }
    },
    "Module": {
      "type": "object",
      "required": [
        "entry_points",
        "functions",
        "types"
      ],
      "properties": {
        "entry_points": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/EntryPoint"
          }
        },
        "functions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Function"
          }
        },
        "types": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Type"
          }
        }
      }
    },
    "Sampling": {
      "type": "string",
      "enum": [
        "Center",
        "Centroid",
        "Sample"
      ]
    },
    "ScalarKind": {
      "type": "string",
      "enum": [
        "Sint",
        "Uint",
        "Float",
        "Bool"
      ]
    },
    "ShaderStage": {
      "type": "string",
      "enum": [
        "Vertex",
        "Fragment",
        "Compute"
      ]
    },
    "SourceLocation": {
      "type": "object",
      "required": [
        "length",
        "lineNumber",
        "linePosition",
        "offset"
      ],
      "properties": {
        "length": {
          "description": "Length in code units (in bytes) of the span.",
          "type": "integer",
          "format": "uint32",
          "minimum": 0.0
        },
        "lineNumber": {
          "description": "1-based line number.",
          "type": "integer",
          "format": "uint32",
          "minimum": 0.0
        },
        "linePosition": {
          "description": "1-based column of the start of this span",
          "type": "integer",
          "format": "uint32",
          "minimum": 0.0
        },
        "offset": {
          "description": "0-based Offset in code units (in bytes) of the start of the span.",
          "type": "integer",
          "format": "uint32",
          "minimum": 0.0
        }
      }
    },
    "StorageFormat": {
      "type": "string",
      "enum": [
        "R8Unorm",
        "R8Snorm",
        "R8Uint",
        "R8Sint",
        "R16Uint",
        "R16Sint",
        "R16Float",
        "Rg8Unorm",
        "Rg8Snorm",
        "Rg8Uint",
        "Rg8Sint",
        "R32Uint",
        "R32Sint",
        "R32Float",
        "Rg16Uint",
        "Rg16Sint",
        "Rg16Float",
        "Rgba8Unorm",
        "Rgba8Snorm",
        "Rgba8Uint",
        "Rgba8Sint",
        "Rgb10a2Unorm",
        "Rg11b10Float",
        "Rg32Uint",
        "Rg32Sint",
        "Rg32Float",
        "Rgba16Uint",
        "Rgba16Sint",
        "Rgba16Float",
        "Rgba32Uint",
        "Rgba32Sint",
        "Rgba32Float"
      ]
    },
    "StructMember": {
      "type": "object",
      "required": [
        "offset",
        "ty"
      ],
      "properties": {
        "binding": {
          "anyOf": [
            {
              "$ref": "#/definitions/Binding"
            },
            {
              "type": "null"
            }
          ]
        },
        "name": {
          "type": [
            "string",
            "null"
          ]
        },
        "offset": {
          "type": "integer",
          "format": "uint32",
          "minimum": 0.0
        },
        "ty": {
          "type": "integer",
          "format": "uint32",
          "minimum": 0.0
        }
      }
    },
    "SupportedExtension": {
      "type": "string",
      "enum": [
        "wgsl",
        "glsl",
        "txt",
        "md",
        "json",
        "csv",
        "png",
        "jpeg",
        "mp3"
      ]
    },
    "Type": {
      "type": "object",
      "required": [
        "inner"
      ],
      "properties": {
        "inner": {
          "$ref": "#/definitions/TypeInner"
        },
        "name": {
          "type": [
            "string",
            "null"
          ]
        }
      }
    },
    "TypeInner": {
      "oneOf": [
        {
          "type": "object",
          "required": [
            "Scalar"
          ],
          "properties": {
            "Scalar": {
              "type": "object",
              "required": [
                "kind",
                "width"
              ],
              "properties": {
                "kind": {
                  "$ref": "#/definitions/ScalarKind"
                },
                "width": {
                  "type": "integer",
                  "format": "uint8",
                  "minimum": 0.0
                }
              }
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "required": [
            "Vector"
          ],
          "properties": {
            "Vector": {
              "type": "object",
              "required": [
                "kind",
                "size",
                "width"
              ],
              "properties": {
                "kind": {
                  "$ref": "#/definitions/ScalarKind"
                },
                "size": {
                  "$ref": "#/definitions/VectorSize"
                },
                "width": {
                  "type": "integer",
                  "format": "uint8",
                  "minimum": 0.0
                }
              }
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "required": [
            "Matrix"
          ],
          "properties": {
            "Matrix": {
              "type": "object",
              "required": [
                "colums",
                "rows",
                "width"
              ],
              "properties": {
                "colums": {
                  "$ref": "#/definitions/VectorSize"
                },
                "rows": {
                  "$ref": "#/definitions/VectorSize"
                },
                "width": {
                  "type": "integer",
                  "format": "uint8",
                  "minimum": 0.0
                }
              }
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "required": [
            "Atomic"
          ],
          "properties": {
            "Atomic": {
              "type": "object",
              "required": [
                "kind",
                "width"
              ],
              "properties": {
                "kind": {
                  "$ref": "#/definitions/ScalarKind"
                },
                "width": {
                  "type": "integer",
                  "format": "uint8",
                  "minimum": 0.0
                }
              }
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "required": [
            "Pointer"
          ],
          "properties": {
            "Pointer": {
              "type": "object",
              "required": [
                "base",
                "space"
              ],
              "properties": {
                "base": {
                  "type": "integer",
                  "format": "uint",
                  "minimum": 0.0
                },
                "space": {
                  "$ref": "#/definitions/AddressSpace"
                }
              }
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "required": [
            "ValuePointer"
          ],
          "properties": {
            "ValuePointer": {
              "type": "object",
              "required": [
                "kind",
                "space",
                "width"
              ],
              "properties": {
                "kind": {
                  "$ref": "#/definitions/ScalarKind"
                },
                "size": {
                  "anyOf": [
                    {
                      "$ref": "#/definitions/VectorSize"
                    },
                    {
                      "type": "null"
                    }
                  ]
                },
                "space": {
                  "$ref": "#/definitions/AddressSpace"
                },
                "width": {
                  "type": "integer",
                  "format": "uint8",
                  "minimum": 0.0
                }
              }
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "required": [
            "Array"
          ],
          "properties": {
            "Array": {
              "type": "object",
              "required": [
                "base",
                "size",
                "stride"
              ],
              "properties": {
                "base": {
                  "type": "integer",
                  "format": "uint",
                  "minimum": 0.0
                },
                "size": {
                  "$ref": "#/definitions/ArraySize"
                },
                "stride": {
                  "type": "integer",
                  "format": "uint32",
                  "minimum": 0.0
                }
              }
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "required": [
            "Struct"
          ],
          "properties": {
            "Struct": {
              "type": "object",
              "required": [
                "members",
                "span"
              ],
              "properties": {
                "members": {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/StructMember"
                  }
                },
                "span": {
                  "type": "integer",
                  "format": "uint32",
                  "minimum": 0.0
                }
              }
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "required": [
            "Image"
          ],
          "properties": {
            "Image": {
              "type": "object",
              "required": [
                "arrayed",
                "class",
                "dim"
              ],
              "properties": {
                "arrayed": {
                  "type": "boolean"
                },
                "class": {
                  "$ref": "#/definitions/ImageClass"
                },
                "dim": {
                  "$ref": "#/definitions/ImageDimension"
                }
              }
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "required": [
            "Sampler"
          ],
          "properties": {
            "Sampler": {
              "type": "object",
              "required": [
                "comparison"
              ],
              "properties": {
                "comparison": {
                  "type": "boolean"
                }
              }
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "required": [
            "BindingArray"
          ],
          "properties": {
            "BindingArray": {
              "type": "object",
              "required": [
                "base",
                "size"
              ],
              "properties": {
                "base": {
                  "type": "integer",
                  "format": "uint",
                  "minimum": 0.0
                },
                "size": {
                  "$ref": "#/definitions/ArraySize"
                }
              }
            }
          },
          "additionalProperties": false
        }
      ]
    },
    "VectorSize": {
      "type": "string",
      "enum": [
        "Bi",
        "Tri",
        "Quad"
      ]
    }
  }
}